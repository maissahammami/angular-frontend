<div class="rapport-medical-container">
  <div class="header">
    <h3>Rapport M√©dical</h3>
    <p>Demande de visite #{{ demandeId }}</p>
    <p class="subtitle">R√©digez le rapport m√©dical suite √† la visite de contr√¥le</p>
  </div>

  <div *ngIf="isLoading" class="loading">
    <div class="spinner-border text-primary" role="status">
      <span class="sr-only">Chargement...</span>
    </div>
    <p>Enregistrement du rapport...</p>
  </div>

  <div *ngIf="!isLoading" class="rapport-form">
    <form [formGroup]="rapportForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="conclusion">Conclusion m√©dicale *</label>
        <textarea 
          formControlName="conclusion" 
          class="form-control" 
          id="conclusion" 
          rows="8" 
          placeholder="R√©digez ici les observations, diagnostics et conclusions de la visite m√©dicale..."
          [class.is-invalid]="rapportForm.get('conclusion')?.invalid && rapportForm.get('conclusion')?.touched">
        </textarea>
        
        <div *ngIf="rapportForm.get('conclusion')?.invalid && rapportForm.get('conclusion')?.touched" 
             class="invalid-feedback">
          <div *ngIf="rapportForm.get('conclusion')?.errors?.['required']">
            La conclusion m√©dicale est obligatoire
          </div>
          <div *ngIf="rapportForm.get('conclusion')?.errors?.['minlength']">
            La conclusion doit contenir au moins 10 caract√®res
          </div>
        </div>

        <small class="form-text text-muted">
          Incluez les observations, diagnostics, recommandations et toute information m√©dicale pertinente.
        </small>
      </div>

      <div class="form-guide">
        <h5>Guide de r√©daction :</h5>
        <ul>
          <li>üìã <strong>Observations</strong> : √âtat g√©n√©ral du patient, signes vitaux</li>
          <li>üîç <strong>Examens r√©alis√©s</strong> : Tests, analyses, imagerie</li>
          <li>üè• <strong>Diagnostic</strong> : Conclusions m√©dicales</li>
          <li>üíä <strong>Traitement</strong> : M√©dicaments prescrits, soins recommand√©s</li>
          <li>üìÖ <strong>Suivi</strong> : Recommandations pour le suivi m√©dical</li>
        </ul>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-success" [disabled]="!rapportForm.valid || isLoading">
          <i class="nc-icon nc-check-2"></i>
          <span *ngIf="!isLoading">Enregistrer le rapport</span>
          <span *ngIf="isLoading">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Enregistrement...
          </span>
        </button>

        <button type="button" class="btn btn-outline-secondary" (click)="rapportForm.reset()">
          <i class="nc-icon nc-refresh-02"></i>
          Effacer
        </button>

        <button type="button" class="btn btn-secondary" routerLink="/agent">
          <i class="nc-icon nc-minimal-left"></i>
          Retour au tableau de bord
        </button>
      </div>
    </form>
  </div>

  <div class="rapport-preview" *ngIf="rapportForm.get('conclusion')?.value">
    <h5>Aper√ßu du rapport :</h5>
    <div class="preview-content">
      <p>{{ rapportForm.get('conclusion')?.value }}</p>
    </div>
    <small class="text-muted">
      Date de cr√©ation : {{ today | date:'dd/MM/yyyy √† HH:mm' }}
    </small>
  </div>
</div>